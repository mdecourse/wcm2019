<!doctype html>
<html><head>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<title>WCM2019</title> <link rel="stylesheet" type="text/css" href="./../static/cmsimply.css">
<script src="tipuesearch_content.js"></script>
<script src="./../static/jquery.js"></script>
<link rel="stylesheet" href="./../static/tipuesearch/css/tipuesearch.css">
<script src="./../static/tipuesearch/tipuesearch_set.js"></script>
<script src="./../static/tipuesearch/tipuesearch.min.js"></script>

<script type="text/javascript" src="./../static/syntaxhighlighter/shCore.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJScript.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushJava.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPython.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushSql.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushXml.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushPhp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushLua.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCpp.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCss.js"></script>
<script type="text/javascript" src="./../static/syntaxhighlighter/shBrushCSharp.js"></script>
<link type="text/css" rel="stylesheet" href="./../static/syntaxhighlighter/css/shCoreDefault.css"/>
<script type="text/javascript">SyntaxHighlighter.all();</script>

<!-- for LaTeX equations 暫時不用 -->
<script src="https://scrum-3.github.io/web/math/MathJax.js?config=TeX-MML-AM_CHTML" type="text/javascript"></script>
<script type="text/javascript">
init_mathjax = function() {
    if (window.MathJax) {
        // MathJax loaded
        MathJax.Hub.Config({
            tex2jax: {
                inlineMath: [ ['$','$'], ["\\(","\\)"] ],
                displayMath: [ ['$$','$$'], ["\\[","\\]"] ]
            },
            displayAlign: 'left', // Change this to 'center' to center equations.
            "HTML-CSS": {
                styles: {'.MathJax_Display': {"margin": 0}}
            }
        });
        MathJax.Hub.Queue(["Typeset",MathJax.Hub]);
    }
}
init_mathjax();
</script>
-->
<!-- 暫時不用
<script src="./../static/fengari-web.js"></script>
<script type="text/javascript" src="./../static/Cango-13v08-min.js"></script>
<script type="text/javascript" src="./../static/CangoAxes-4v01-min.js"></script>
<script type="text/javascript" src="./../static/gearUtils-05.js"></script>
-->
<!-- for Brython 暫時不用
<script src="https://scrum-3.github.io/web/brython/brython.js"></script>
<script src="https://scrum-3.github.io/web/brython/brython_stdlib.js"></script>
-->
<style>
img.with_border {
    border: 3px solid red;
}
</style>

<script type="text/javascript">
/*shorthand of $(document).ready(function(){};); */
$(function(){
    $("ul.topmenu> li:has(ul) > a").append('<div class="arrow-right"></div>');
    $("ul.topmenu > li ul li:has(ul) > a").append('<div class="arrow-right"></div>');
});
function doSearch() {
     $('#tipue_search_input').tipuesearch({
        newWindow: true, minimumLength: 2
     });
}
$(document).ready(doSearch);
</script>

</head><header><h1>2019 Spring 網際內容管理</h1> <confmenu>
<ul>
<li><a href="index.html">Home</a></li>
<li><a href="sitemap.html">Site Map</a></li>
<li><a href="./../reveal/index.html">reveal</a></li>
<li><a href="./../blog/index.html">blog</a></li>

</ul>
</confmenu></header>
<div class='container'><nav><ul id='css3menu1' class='topmenu'><div class="tipue_search_group"><input style="width: 6vw;" type="text" name="q" id="tipue_search_input" pattern=".{2,}" title="Press enter key to search" required></div><li><a href='Introduction.html'>Introduction</a><ul><li><a href='P-Tech.html'>P-Tech</a><li><a href='C-K and future job.html'>C-K and future job</a><li><a href='計算機程式.html'>計算機程式</a><li><a href='全球協同.html'>全球協同</a></li></ul><li><a href='實習任務.html'>實習任務</a><ul><li><a href='實習任務一.html'>實習任務一</a><ul><li><a href='task1 Q&A.html'>task1 Q&A</a></li></ul><li><a href='實習項目二.html'>實習項目二</a><ul><li><a href='ANSI C.html'>ANSI C</a><li><a href='Git 設定.html'>Git 設定</a><li><a href='Blogger API.html'>Blogger API</a><li><a href='Blogger API 應用.html'>Blogger API 應用</a></li></ul><li><a href='實習項目三.html'>實習項目三</a><ul><li><a href='game1.html'>game1</a><li><a href='canvas1.html'>canvas1</a><li><a href='Brython.html'>Brython</a><li><a href='Cango Library.html'>Cango Library</a><li><a href='Ball.html'>Ball</a><li><a href='two.js.html'>two.js</a><li><a href='Konva demo.html'>Konva demo</a><li><a href='matter.js.html'>matter.js</a></li></ul><li><a href='實習項目四.html'>實習項目四</a><li><a href='實習項目五.html'>實習項目五</a></li></ul><li><a href='分組專題.html'>分組專題</a><ul><li><a href='電腦安裝.html'>電腦安裝</a><ul><li><a href='建立伺服器.html'>建立伺服器</a></li></ul><li><a href='網路配置.html'>網路配置</a><ul><li><a href='Proxy Server.html'>Proxy Server</a></li></li></ul></ul><li><a href='程式開發環境.html'>程式開發環境</a><ul><li><a href='Windows 10.html'>Windows 10</a><li><a href='Ubuntu.html'>Ubuntu</a><li><a href='CentOS.html'>CentOS</a></li></ul><li><a href='CMSimfly 安裝.html'>CMSimfly 安裝</a><ul><li><a href='Github.html'>Github</a><li><a href='Heroku.html'>Heroku</a><li><a href='自架主機.html'>自架主機</a></li></ul><li><a href='CMSimfly 開發.html'>CMSimfly 開發</a><ul><li><a href='Front-end.html'>Front-end</a><li><a href='繪圖.html'>繪圖</a></li></ul><li><a href='相關技術.html'>相關技術</a><ul><li><a href='Pygrouf.html'>Pygrouf</a><li><a href='Konva.html'>Konva</a><li><a href='X3d.html'>X3d</a><li><a href='Wagtail.html'>Wagtail</a><li><a href='Fossil SCM.html'>Fossil SCM</a><ul><li><a href='文件檔案管理.html'>文件檔案管理</a></li></ul><li><a href='自動控制.html'>自動控制</a><li><a href='機構模擬.html'>機構模擬</a></li></ul><li><a href='參考資料.html'>參考資料</a></li></ul></nav><section><div id="tipue_search_content">實習項目二 << <a href='實習項目二.html'>Previous</a> <a href='Git 設定.html'>Next</a> >> Git 設定<br /><h1>ANSI C</h1>
<h4>KMOL 2019 Spring 所採用的可攜程式環境:</h4>
<p><a href="https://drive.google.com/file/d/1_TQBw1PM7jxrmtsBjvLKbjJWfGs8Ug79/view?usp=sharing">cdb_w5 版本.7z</a><span><span> </span>(470 MB, 解開後 1.3 GB, wcm 與 cd 課程共用版本)<span> </span></span></p>
<p>KMOL 課程 (指計算機程式、網際內容管理、電腦輔助設計實習與協同產品設計實習) 所使用的可攜系統中, 採用 <a href="https://bellard.org/tcc/">Tiny C</a> 作為 ANSIC 程式編譯系統, 且透過 SciTE 編輯器的設定, 讓 ANSI C 程式的執行與解譯程式 (如 Python 與 Lua) 類似, 可以直接在 SciTE 編輯器中執行簡單的運算程式, 或利用 <a href="https://bellard.org/tcc/">Tiny C</a> 將 C 程式編譯為 Python  或 Lua 可以呼叫的動態程式庫.</p>
<p>由於 ANSI C 程式編譯後執行的速度遠快於 Python 或 Lua, 但是利用解譯程式呼叫動態連結庫的方式進行數值分析運算, 可以同時取得調控彈性高與執行速度快的好處, 因此 KMOL 才將可攜程式套件以 <a href="https://bellard.org/tcc/">Tiny C</a> 結合 Python3 與 Lua 5.1.5 的方式進行配置.</p>
<p>以下為 <a href="https://bellard.org/tcc/">Tiny C</a> 的相關應用:</p>
<h4>利用 Tiny C 編譯 Tiny C</h4>
<p>使用者可以從 <a href="http://download.savannah.gnu.org/releases/tinycc/">http://download.savannah.gnu.org/releases/tinycc/</a> 下載 tcc-0.9.27.tar.bz2, 也就是 0.9.27 版的 Tiny C 編譯程式原始碼, 然後利用 KMOL 可攜程式中的 <a href="https://bellard.org/tcc/">Tiny C</a> 對此 ANSI C程式碼進行編譯, 建立 0.9.27 版的 tcc.exe</p>
<p>啟動 KMOL 可攜程式後, 在 Dos 命令列中進入 0.9.27 原始碼中的 win32 目錄, 將其中 build-tcc.bat 檔案中的 </p>
<p>      set CC=gcc</p>
<p>改為</p>
<p>     set CC=tcc</p>
<p>然後執行此一 build-tcc.bat 檔案, 就可以編譯出所需的 tcc.exe, libtcc.dll 與 i386-win32-tcc.exe 等三個檔案.</p>
<h4>利用 ANSI C 程式解數值分析</h4>
<p>參考資料: </p>
<p><a href="http://mde.tw/cp2018/content/數值分析.html">http://mde.tw/cp2018/content/數值分析.html</a></p>
<p><a href="https://github.com/libsbmlsim/libsbmlsim">https://github.com/libsbmlsim/libsbmlsim</a> (<a href="https://fun.bio.keio.ac.jp/software/libsbmlsim/">libsbmlsim</a>)</p>
<p><a href="http://sbml.org/Basic_Introduction_to_SBML">http://sbml.org/Basic_Introduction_to_SBML</a></p>
<p>以 <a href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta</a> 解常微分方程式:</p>
<pre class="brush:cpp;auto-links:false;toolbar:false" contenteditable="false">// C program to implement Runge Kutta method 
#include&lt;stdio.h&gt; 
  
// A sample differential equation "dy/dx = (x - y)/2" 
float dydx(float x, float y) 
{ 
    return((x - y)/2); 
} 
// Finds value of y for a given x using step size h 
// and initial value y0 at x0. 
float rungeKutta(float x0, float y0, float x, float h) 
{ 
    // Count number of iterations using step size or 
    // step height h 
    int n = (int)((x - x0) / h); 
  
    float k1, k2, k3, k4, k5; 
  
    // Iterate for number of iterations 
    float y = y0; 
    for (int i=1; i&lt;=n; i++) 
    { 
        // Apply Runge Kutta Formulas to find 
        // next value of y 
        k1 = h*dydx(x0, y); 
        k2 = h*dydx(x0 + 0.5*h, y + 0.5*k1); 
        k3 = h*dydx(x0 + 0.5*h, y + 0.5*k2); 
        k4 = h*dydx(x0 + h, y + k3); 
  
        // Update next value of y 
        y = y + (1.0/6.0)*(k1 + 2*k2 + 2*k3 + k4);; 
  
        // Update next value of x 
        x0 = x0 + h; 
    } 
  
    return y; 
} 

// Driver method 
int main() 
{ 
    float x0 = 0, y = 1, x = 2, h = 0.2; 
    printf("\nThe value of y at x is : %f\n", 
            rungeKutta(x0, y, x, h)); 
    return 0; 
} </pre>
<h4>利用 ANSI C 編寫 Python 3 呼叫用 dll</h4>
<p>首先, 建立一個 multiply.c 程式:</p>
<pre class="brush:cpp;auto-links:false;toolbar:false" contenteditable="false">#include &lt;stdio.h&gt;
 
int multiply(int, int);
 
__declspec(dllexport) int
multiply(int num1, int num2)
{
return num1 * num2;
}</pre>
<div>
<div class="syntaxhighlighter c" id="highlighter_631405"></div>
</div>
<p>利用下列指令, 將 multiply.c 編譯為動態連結庫 myltiply.dll</p>
<p>tcc -w -shared -DLIBTCC_AS_DLL -DONE_SOURCE multiply.c -o multiply.dll</p>
<p>接著利用下列 Python3 程式, 透過 ctypes 模組導入 multiply.dll, 並且執行動態連結程式庫中的 multiply() 函式.</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import ctypes
 
lib = ctypes.CDLL('multiply.dll')
result = lib.multiply(3, 2)
print(result)</pre>
<div>
<div class="syntaxhighlighter python" id="highlighter_374291"></div>
</div>
<p>因為<span> </span><a href="https://docs.python.org/3/library/ctypes.html">ctypes</a><span> </span>內建傳回值為 int, 因此若 C 對應動態連結庫輸入或傳回值為浮點數, 就必須手動宣告.</p>
<p>例如, 將上述函式的輸入與輸出均由 int 改為 float 如下:</p>
<pre class="brush:cpp;auto-links:false;toolbar:false" contenteditable="false">// multiply2.c
#include &lt;stdio.h&gt;
 
float multiply(float, float);
 
__declspec(dllexport) float
multiply(float num1, float num2)
{
return num1 * num2;
}</pre>
<div>
<div class="syntaxhighlighter c" id="highlighter_489981"></div>
</div>
<p>可利用下列指令, 將 multiply2.c 編譯為動態連結庫 myltiply2.dll</p>
<p>tcc -w -shared -DLIBTCC_AS_DLL -DONE_SOURCE multiply2.c -o multiply2.dll</p>
<p>但是 Python3 程式部份就必須改為:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import ctypes
 
lib = ctypes.CDLL('multiply2.dll')
# By default functions are assumed to return the C int type. Other return types can be specified by setting the restype attribute of the function object.
lib.multiply.restype = ctypes.c_float
result = lib.multiply(ctypes.c_float(3.0), ctypes.c_float(2.0))
print(result)</pre>
<div>
<div class="syntaxhighlighter python" id="highlighter_532977"></div>
</div>
<h4>導入 tinycc 模組</h4>
<p>除了直接利用 Tiny C 編譯能讓 Python 3 呼叫的動態連結程式庫外, 也可以導入 <a href="https://github.com/SasView/tinycc">https://github.com/SasView/tinycc</a> (<a href="./../downloads/tinycc-1.1.zip">tinycc-1.1.zip</a>), 並將 tcc.exe 所在目錄設於啟動批次檔案中:</p>
<p>set TCC_ROOT=%Disk%:\tcc</p>
<p>之後使用者就能利用:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">from tinycc import compile
dll_path = compile("multiply.c")</pre>
<p>建立所需的 multiply.dll, 其中 multiply.c 內容:</p>
<pre class="brush:cpp;auto-links:false;toolbar:false" contenteditable="false">#include &lt;stdio.h&gt;
 
int multiply(int, int);
 
int multiply(int num1, int num2)
{
    return num1 * num2;
}</pre>
<p>而對應的 multiply.py 內容如下:</p>
<pre class="brush:py;auto-links:false;toolbar:false" contenteditable="false">import ctypes
 
lib = ctypes.CDLL('multiply.dll')
result = lib.multiply(3, 2)
print(result)</pre>
<h4>另外一個有趣的應用, 就是利用 <a href="https://bellard.org/tcc/">Tiny C</a> 編譯 <a href="https://www.fossil-scm.org">Fossil SCM</a></h4>
<p>因為 <a href="https://www.fossil-scm.org">Fossil SCM</a> 也是採用 ANSI C 格式編寫, 因此從 <a href="https://www.mail-archive.com/fossil-users@lists.fossil-scm.org/msg11086.html">https://www.mail-archive.com/fossil-users@lists.fossil-scm.org/msg11086.html</a> 與 <a href="http://lists.nongnu.org/archive/html/tinycc-devel/2014-03/msg00086.html">http://lists.nongnu.org/archive/html/tinycc-devel/2014-03/msg00086.html</a> 討論中, 可以利用 <a href="https://bellard.org/tcc/">Tiny C</a><span><span> </span></span> 編譯 <a href="https://www.fossil-scm.org">Fossil SCM</a><span><span> , 但是僅能在 Linux 環境, </span></span> Windows 10 上的 <a href="https://www.fossil-scm.org">Fossil SCM</a>, 則可使用 <a href="https://www.msys2.org/">MSYS2</a> (<a href="http://lab.kmol.info/blog/msys2_compile_fossil_scm.html">http://lab.kmol.info/blog/msys2_compile_fossil_scm.html</a>)</p><br />實習項目二 << <a href='實習項目二.html'>Previous</a> <a href='Git 設定.html'>Next</a> >> Git 設定</div></section></div></body></html>